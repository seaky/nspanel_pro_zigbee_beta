import{u as f,j as e,P as y,r as b,B as j}from"./index-74e84a13.js";import{i as _,g as S,T as C,D as F}from"./DashboardFeatureWrapper-30f9acc7.js";function P(s){const{value:n,values:l,disabled:m,onChange:t,label:a,...r}=s,{t:p}=f("common"),c=i=>{t(i.target.value)},o=l.length==1,u=l.map(i=>e.jsx("option",{value:i,children:i},i));return u.unshift(e.jsx("option",{hidden:!0,children:p("select_endpoint")},"hided")),e.jsxs("div",{className:"form-group",children:[a&&e.jsx("label",{className:"form-label",children:a}),e.jsx("select",{disabled:n&&o||m,value:n,className:"form-control",title:o?p("the_only_endpoint"):"",onChange:c,...r,children:u})]})}function R(s){const{t:n}=f("common"),{devices:l,value:m,label:t,onChange:a,groups:r=[],...p}=s,c=i=>{const{value:d}=i.target;if(l[d])a(l[d],"device");else{const x=r.find(h=>parseInt(d,10)===h.id);a(x,"group")}};let o=[e.jsx("option",{hidden:!0,children:n("select_device")},"hidden")];const u=[];if(Object.values(l).sort((i,d)=>i.friendly_name.localeCompare(d.friendly_name)).forEach(i=>{var d;u.push(e.jsx("option",{title:(d=i.definition)==null?void 0:d.description,value:i.ieee_address,children:y(i)},i.ieee_address))}),r&&r.length){const i=r.map(d=>e.jsx("option",{value:d.id,children:d.friendly_name},d.friendly_name));o.push(e.jsx("optgroup",{label:n("groups"),children:i},"Groups")),o.push(e.jsx("optgroup",{label:n("devices"),children:u},"Devices"))}else o=o.concat(u);return e.jsxs("div",{className:"form-group",children:[t&&e.jsx("label",{className:"form-label",children:t}),e.jsx("select",{value:m,onChange:c,className:"form-control",...p,children:o})]})}const k=["state","color_temp","color","transition","brightness"];function v(s,n={}){let{property:l,name:m,features:t}=s;if(_(s)&&(t=t.map(a=>v(a,l?n[l]:n)).filter(a=>a),t=Object.values(S(t,"property")).map(a=>a[0])),k.includes(m)||Array.isArray(t)&&t.length>0)return{...s,features:t}}function g(s){if(s.endpoints){const n=[];return Object.entries(s.endpoints).forEach(([l,m])=>{var t;(t=m.scenes)==null||t.forEach(a=>n.push({...a,endpoint:l}))}),n}else if(s.scenes)return s.scenes;return[]}const D=(s,n=[])=>s>=0&&s<=255&&!n.find(l=>l.id==s);function I(s){var x;const{target:n,deviceState:l,sceneStore:m,setDeviceState:t}=s,a=g(n),{t:r}=f("scene"),[p,c]=b.useState(0),[o,u]=b.useState(""),i=`Scene ${p}`;let d=[];return n.definition&&(d=(((x=n.definition)==null?void 0:x.exposes)??[]).map(h=>v(h,l)).filter(h=>h)),e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:r("add_update_header")}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"add-scene",className:"form-label",children:r("scene_id")}),e.jsx("input",{id:"add-scene",className:"form-control",min:0,max:255,value:p,type:"number",onChange:h=>c(h.target.valueAsNumber)}),e.jsx("label",{htmlFor:"add-scene-name",className:"form-label",children:r("scene_name")}),e.jsx("input",{id:"add-scene-name",className:"form-control",value:o,type:"string",onChange:h=>u(h.target.value),placeholder:i}),e.jsx(C,{feature:{features:d},className:"row",type:"composite",device:n,deviceState:l,onChange:(h,N)=>{t(n.friendly_name,N)},featureWrapperClass:F,minimal:!0})]}),e.jsx("div",{className:"d-flex",children:e.jsx("button",{disabled:!D(p,a),type:"submit",onClick:()=>m(n.friendly_name,{id:p,name:o||i}),className:"btn btn-primary ms-auto",children:r("store")})})]})}function E(s){const{t:n}=f("scene"),{onSceneSelected:l,scenes:m=[],value:t}=s,a=c=>{const[o,u]=c.target.value.split("-");l({id:parseInt(o,10),endpoint:u})},r=e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"rr-scene",className:"form-label",children:n("scene_name")}),e.jsxs("select",{onChange:a,id:"rr-scene",className:"form-select",children:[e.jsx("option",{hidden:!0,children:n("select_scene")},"hidden"),m.map(c=>e.jsxs("option",{value:`${c.id}-${c.endpoint}`,children:[c.id,": ",c.name]},`${c.id}-${c.endpoint}`))]})]}),p=e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"rr-scene",className:"form-label",children:n("scene_id")}),e.jsx("input",{min:0,value:t.id,type:"number",className:"form-control",id:"rr-scene",onChange:c=>l({id:c.target.valueAsNumber,endpoint:void 0})})]});return e.jsx(e.Fragment,{children:m.length>0?r:p})}function $(s){const{sceneRecall:n,sceneRemove:l,sceneRemoveAll:m,target:t}=s,{t:a}=f("scene"),[r,p]=b.useState({id:0,endpoint:void 0}),c=r.id===void 0,o=g(t),{friendly_name:u}=t;return e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:a("manage_scenes_header")}),e.jsx("div",{className:"mb-3",children:e.jsx(E,{onSceneSelected:p,value:r,scenes:o})}),e.jsxs("div",{className:"d-flex",children:[e.jsxs("div",{className:"btn-group ms-auto pe-1",children:[e.jsx("button",{disabled:c,onClick:()=>n(u,r.id,r.endpoint),type:"submit",className:"btn btn-success",children:a("recall")}),e.jsx(j,{disabled:c,prompt:!0,onClick:()=>l(u,r.id,r.endpoint),type:"submit",className:"btn btn-danger",children:a("remove")})]}),e.jsx(j,{prompt:!0,onClick:()=>m(u,""),type:"submit",className:"btn btn-danger",children:a("remove_all")})]})]})}export{I as A,R as D,P as E,$ as R,v as o};
